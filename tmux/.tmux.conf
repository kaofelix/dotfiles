################################################################################
# Tmux Configuration for Learning
# =================================
# This config keeps vanilla tmux keybindings but adds sensible defaults.
# Comments explain what each setting does so you can learn as you customize.
################################################################################

# -----------------------------------------------------------------------------
# BASICS
# -----------------------------------------------------------------------------

# Enable truecolor support (better colors in terminal)
set -g default-terminal "tmux-256color"
set -as terminal-overrides ",tmux-256color:RGB:Tc"

# Set default shell for tmux (prevents multiple shell startups)
set -g default-shell $SHELL

# Reduce delay when pressing keys (important for repeated commands)
# 0 = fastest, 10 = safe if you have slow terminal
set -s escape-time 10

# Increase scrollback history (default 2000, 50000 is more useful)
set -g history-limit 50000

# Enable focus events (allows emacs/vim to detect pane focus)
# Useful for autoread in editors
set -g focus-events on

# Start windows and panes at 1 (more intuitive than 0)
set -g base-index 1
setw -g pane-base-index 1

# Automatically renumber windows when one is closed
set -g renumber-windows on

# Rename windows automatically? (on=automatic, off=manual control)
setw -g automatic-rename off

# Set terminal title to show session name
set -g set-titles on
set -g set-titles-string "#S [#I:#W]"  # Session name [window:window-name]

# Allow applications to set window name (vim, emacs, etc.)
# When enabled, apps can update the window title via escape sequences
setw -g allow-rename on

# Aggressive resize - only resize visible panes
# Useful when attaching from terminals of different sizes
setw -g aggressive-resize on

# -----------------------------------------------------------------------------
# PREFIX KEY
# -----------------------------------------------------------------------------
# The prefix is the key you press before tmux commands.
# Default is C-b, but C-b is used in emacs (backward-char).
# Options: C-a (screen/tmux default), C-space, C-q, or keep C-l
# Note: C-l is also used in emacs (clear-screen), so you'll need C-l C-l in emacs

set -g prefix C-l
unbind C-b
bind C-l send-prefix

# -----------------------------------------------------------------------------
# RELOAD CONFIG
# -----------------------------------------------------------------------------
# Prefix + r reloads this file so you can test changes quickly
unbind r
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# -----------------------------------------------------------------------------
# MOUSE SUPPORT
# -----------------------------------------------------------------------------
# Keep this on while learning - it helps understand what's happening
# You can turn it off later for pure keyboard-driven workflow
set -g mouse on

# -----------------------------------------------------------------------------
# STATUS BAR
# -----------------------------------------------------------------------------
# A clean, informative status bar shows sessions, windows, and time

# Status bar position (bottom is default, top is an option)
# set -g status-position top  # Uncomment to move to top

# Status bar colors
set -g status-style "bg=black,fg=white"

# Current session name (left side)
set -g status-left-length 30
set -g status-left "#[fg=green]#S "

# Windows list (center)
setw -g window-status-format "#[fg=cyan]#I:#[fg=white]#W "
setw -g window-status-current-format "#[fg=black,bg=green]#I:#W "

# Right side: time and date
set -g status-right " #[fg=cyan]%Y-%m-%d %H:%M"

# Update status bar every second
set -g status-interval 1

# -----------------------------------------------------------------------------
# PANES
# -----------------------------------------------------------------------------
# Pane borders - subtle colors to distinguish active pane
set -g pane-border-style "fg=white"
set -g pane-active-border-style "fg=green"

# Show pane numbers (Prefix + q briefly shows numbers)
# Useful when you have many panes

# -----------------------------------------------------------------------------
# COPY MODE (like scrolling through history)
# -----------------------------------------------------------------------------
# Press Prefix + [ to enter copy mode, then:
# - emacs-style: C-n, C-p, C-v, M-v, C-s (search)
# - vi-style: j, k, PageUp, PageDown, / (search)
# Press q or Enter to exit

# Use emacs keys in copy mode (default for emacs users)
setw -g mode-keys emacs

# Copy to system clipboard when in copy mode
# yank: Prefix + ] (paste from tmux buffer)
# copy: in copy mode, select text then press Enter or M-w
set -s copy-command 'pbcopy'

# -----------------------------------------------------------------------------
# SPLITTING WINDOWS
# -----------------------------------------------------------------------------
# These are the vanilla commands, but we add friendly aliases
# Prefix + | → split vertical (left/right panes)
# Prefix + - → split horizontal (top/bottom panes)

bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# Create new window in current path (instead of home directory)
bind c new-window -c "#{pane_current_path}"

# -----------------------------------------------------------------------------
# NAVIGATING PANES & WINDOWS
# -----------------------------------------------------------------------------
# Vanilla tmux navigation:
# Prefix + Arrow keys    → move between panes
# Prefix + Prefix        → move to last pane
# Prefix + n/p           → next/previous window
# Prefix + 1,2,3...      → go to window number
# Prefix + w             → show window list

# For emacs users, you might want:
# Prefix + C-x o (like emacs' other-window) - not bound by default

# -----------------------------------------------------------------------------
# BROADCAST INPUT (type in all panes at once)
# -----------------------------------------------------------------------------
# Prefix + ` (backtick) toggles broadcasting
# Great for running the same command on multiple servers
bind ` setw synchronize-panes \; display "Sync panes: #{?pane_synchronized,ON,OFF}"

# -----------------------------------------------------------------------------
# ACTIVITY ALERTS
# -----------------------------------------------------------------------------
# Highlight windows when there's activity
setw -g monitor-activity on
set -g visual-activity on

# -----------------------------------------------------------------------------
# SESSIONS (multiple workspaces)
# -----------------------------------------------------------------------------
# Sessions are like separate tmux instances
# Useful for different projects or contexts
# Commands:
# Prefix + s         → list sessions
# Prefix + $         → rename current session
# Prefix + (         → previous session
# Prefix + )         → next session

# Press Prefix + h for learning guide
bind h split-window -h "less ~/dotfiles/tmux/TMUX_LEARNING.md"

# Prefix + ? shows keybindings with fzf (overrides default list-keys)
bind ? display-popup -E "tmux list-keys -N | fzf"

# -----------------------------------------------------------------------------
# WHAT'S NEW IN THIS VERSION
# -----------------------------------------------------------------------------
# Compared to the "latest example":
# ✅ Added history-limit 50000 (more scrollback)
# ✅ Added focus-events (for emacs/vim autoread)
# ✅ Added truecolor support (RGB)
# ✅ Added aggressive-resize (multi-client support)
# ✅ Added current path for new windows
# ❌ Kept C-l prefix (not C-a)
# ❌ Kept arrow key navigation (not h/j/k/l - learn vanilla first)
# ❌ Kept emacs copy mode (not vi)
# ❌ No plugins (keep vanilla for now)
# ❌ Simple colors (don't theme yet - focus on learning)
#
# WHEN YOU'RE READY TO EVOLVE:
# 1. Try vim-style pane navigation (h/j/k/l) - it's faster than arrows
# 2. Consider TPM plugins (resurrect saves sessions, continuum auto-loads)
# 3. Customize colors/themes once you know tmux well
# 4. Consider different prefix (C-a is common, C-space is good too)
#
# -----------------------------------------------------------------------------
# LEARNING TIPS (remove these when you've learned)
# -----------------------------------------------------------------------------
# ESSENTIAL COMMANDS:
#   tmux                          → start new session
#   tmux attach -t name           → attach to session 'name'
#   tmux new -s name              → create named session
#   tmux ls                       → list sessions
#   tmux kill-session -t name     → delete session
#
# KEYBINDING CHEATSHEET:
#   Prefix + ?                    → list all keybindings
#   Prefix + :                    → command prompt (enter any tmux command)
#   Prefix + [                    → enter copy/scroll mode
#   Prefix + ]                    → paste from copy buffer
#   Prefix + c                    → create new window
#   Prefix + ,                    → rename window
#   Prefix + &                    → kill window
#   Prefix + x                    → kill pane
#   Prefix + d                    → detach from session (keep it running)
#   Prefix + z                    → zoom pane (toggle fullscreen)
#   Prefix + { → swap pane with previous
#   Prefix + } → swap pane with next
#
# LEARNING RESOURCES:
#   - https://github.com/tmux/tmux/wiki (official wiki)
#   - https://tmuxcheatsheet.com/ (quick reference)
#   - man tmux                    → comprehensive manual
#   - Prefix + :then "list-keys"  → see all bindings in tmux
#
# PROGRESSION SUGGESTION:
#   1. Week 1: Use Prefix + ? to learn bindings, keep mouse on
#   2. Week 2: Turn off mouse, learn pane navigation with Prefix + Arrow
#   3. Week 3: Learn split commands, start organizing workspaces
#   4. Week 4: Learn sessions for different projects
#   5. After: Customize based on YOUR workflow, not conventions
################################################################################
